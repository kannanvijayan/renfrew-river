(()=>{"use strict";var e={651:function(e,t,n){var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function r(e){try{d(s.next(e))}catch(e){o(e)}}function a(e){try{d(s.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.GameClientConnectError=void 0;const i=n(858);var o;!function(e){e.CONNECTION_FAILED="connection-failed"}(o||(t.GameClientConnectError=o={}));t.default=class{constructor(e){const{url:t,callbacks:n}=e;this.url_=t,this.callbacks_=n,this.ws_=new WebSocket(t),this.responseAwaiters_=[],this.ws_.addEventListener("open",this.onOpen.bind(this)),this.ws_.addEventListener("close",this.onClose.bind(this)),this.ws_.addEventListener("error",(e=>this.onError("Connection failed",e))),this.ws_.addEventListener("message",this.onMessage.bind(this))}disconnect(){this.ws_.close()}getConstants(){return s(this,void 0,void 0,(function*(){const e=yield this.sendCommand("GetConstants",{});if("Constants"in e)return e.Constants;throw new Error("GetConstants: unexpected response")}))}defaultSettings(){return s(this,void 0,void 0,(function*(){const e=yield this.sendCommand("DefaultSettings",{});if("DefaultSettings"in e){return{settings:e.DefaultSettings.settings,min_world_dims:e.DefaultSettings.min_world_dims,max_world_dims:e.DefaultSettings.max_world_dims}}throw new Error("DefaultSettings: unexpected response")}))}hasGame(){return s(this,void 0,void 0,(function*(){const e=yield this.sendCommand("HasGame",{});return"GameExists"in e&&e.GameExists.settings}))}newGame(e){return s(this,void 0,void 0,(function*(){const t=yield this.sendCommand("NewGame",{settings:e});if("Error"in t)throw new Error(t.Error.messages.join(", "))}))}readMapData(e){return s(this,void 0,void 0,(function*(){const t=yield this.sendCommand("ReadMapData",{top_left:e.topLeft,area:e.area,kinds:e.kinds});if("MapData"in t){const n={};for(const s of e.kinds){const e=i.ReadMapDataOutputNameMap[s];n[e]=t.MapData[e]}return n}throw new Error(t.Error.messages.join(", "))}))}miniElevations(e){return s(this,void 0,void 0,(function*(){const t=yield this.sendCommand("MiniElevations",{mini_dims:e.miniDims});if("MiniElevations"in t)return t.MiniElevations.elevations;throw new Error(t.Error.messages.join(", "))}))}readAnimals(){return s(this,void 0,void 0,(function*(){const e=yield this.sendCommand("ReadAnimals",{});if("Animals"in e)return e.Animals.animals;throw new Error(e.Error.messages.join(", "))}))}takeTurnStep(){return s(this,void 0,void 0,(function*(){const e=yield this.sendCommand("TakeTurnStep",{});if("TurnTaken"in e)return e.TurnTaken;throw new Error(e.Error.messages.join(", "))}))}getCellInfo(e){return s(this,void 0,void 0,(function*(){const t=yield this.sendCommand("GetCellInfo",{cell_coord:e});if("CellInfo"in t)return t.CellInfo;throw new Error(t.Error.messages.join(", "))}))}getAnimalData(e){return s(this,void 0,void 0,(function*(){const t=yield this.sendCommand("GetAnimalData",{animal_id:e});if("AnimalData"in t)return t.AnimalData;throw new Error(t.Error.messages.join(", "))}))}sendCommand(e,t){return s(this,void 0,void 0,(function*(){const n={[e]:t},s=JSON.stringify(n);let i,o;this.responseAwaiters_.length>0?this.responseAwaiters_[this.responseAwaiters_.length-1].promise.then((()=>this.ws_.send(s))):this.ws_.send(s);const r=new Promise(((e,t)=>{i=e,o=t})),a={command:e,resolve:i,reject:o,promise:r};return this.responseAwaiters_.push(a),r}))}onOpen(){this.callbacks_.onConnect()}onClose(){var e,t;for(const e of this.responseAwaiters_)e.reject("Connection closed");this.responseAwaiters_=[],null===(t=(e=this.callbacks_).onClose)||void 0===t||t.call(e)}onError(e,t){for(const t of this.responseAwaiters_)t.reject(`Connection errored: ${e}`);this.responseAwaiters_=[],this.callbacks_.onError(e)}onMessage(e){if("string"!=typeof e.data)throw new Error("GameClient.onMessage: unexpected message type");{const t=JSON.parse(e.data),n=this.responseAwaiters_.shift();if(!n)throw new Error("GameClient.onMessage: no awaiter");n.resolve(t)}}}},563:function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=s(n(651));t.default=i.default},858:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReadMapDataOutputNameMap=void 0,t.ReadMapDataOutputNameMap={Elevation:"elevations",AnimalId:"animal_ids"}}},t={};(function n(s){var i=t[s];if(void 0!==i)return i.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,n),o.exports})(563)})();